import{j as e,o as F,s as D,t as O,g as U,a as y}from"./admin-CjE1p_fZ.js";import{r as n,u as $}from"./router-DqluUKdp.js";import{u as _}from"./auth-Tf0T-Vub.js";import{u as H,a as q}from"./shop-NOs0Rz2B.js";import"./icons-CDVIwAiG.js";import"./charts-hD1MI6At.js";import"./vendor-Tt9FPAzf.js";import"./slick-JyPX3RhO.js";import"./stripe-DnwkPVAo.js";function z(){const[i,c]=n.useState([]),[l,j]=n.useState(!0),[m,x]=n.useState("");return n.useEffect(()=>{(async()=>{try{const r=await y("/orders/user/my-orders",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(r.ok){const u=await r.json();c(u)}else x("Failed to load orders")}catch(r){x(r.message)}finally{j(!1)}})()},[]),l?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500 mx-auto mb-4"}),e.jsx("p",{className:"text-[#171717]",children:"Loading orders..."})]}):m?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-red-500",children:m})}):i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(F,{className:"text-6xl text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-[#171717] mb-2",children:"No Orders Yet"}),e.jsx("p",{className:"text-gray-500",children:"You haven't made any purchases yet."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Order History"}),i.map(s=>e.jsxs("div",{className:"bg-white rounded-lg shadow-md border p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2 md:mb-0",children:[e.jsx(F,{className:"text-blue-600"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900",children:["Order #",s._id.slice(-8)]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-[#171717]",children:[e.jsx(D,{className:"text-xs"}),e.jsx("span",{children:new Date(s.createdAt).toLocaleDateString()})]})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-1 text-lg font-bold text-green-600",children:[e.jsx(O,{className:"text-sm"}),e.jsx("span",{children:s.totalPrice.toFixed(2)})]}),e.jsx("span",{className:`text-sm px-2 py-1 rounded-full ${s.status==="پرداخت شده"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:s.status})]})})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("h4",{className:"font-medium text-gray-700 mb-3",children:["Items (",s.items.length,")"]}),e.jsxs("div",{className:"space-y-2",children:[s.items.slice(0,3).map((r,u)=>e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[r.productId?.images?.[0]&&e.jsx("img",{src:U(r.productId.images[0]),alt:r.productId.name,className:"w-10 h-10 object-cover rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium",children:r.productId?.name||r.name}),e.jsxs("span",{className:"text-gray-500 ml-2",children:["x",r.quantity]})]}),e.jsxs("span",{className:"font-medium",children:["€",(r.price*r.quantity).toFixed(2)]})]},u)),s.items.length>3&&e.jsxs("p",{className:"text-sm text-gray-500 italic",children:["+",s.items.length-3," more items"]})]})]}),e.jsx("div",{className:"border-t pt-4 mt-4",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-[#171717]",children:[e.jsxs("span",{children:["Payment ID: ",s.paymentIntentId?.slice(-12)]}),e.jsx("button",{className:"text-blue-600 hover:text-blue-800 font-medium",children:"View Details"})]})})]},s._id))]})}function K(){const{user:i,loading:c,logout:l,updateUser:j}=_(),{clearCart:m}=H(),{clearWishlist:x}=q(),[s,r]=n.useState({username:"",email:"",first_name:"",last_name:"",phone:"",address:""}),[u,w]=n.useState(!0),[k,S]=n.useState(!1),[h,C]=n.useState("profile"),[E,f]=n.useState(""),[P,p]=n.useState(""),[N,b]=n.useState(""),o=$(),T=async()=>{try{f(""),p(""),b("");const t=await y("/profile");if(!t.ok){if(t.status===401){l(),o("/login");return}throw new Error(`HTTP ${t.status}: Failed to load profile`)}const a=await t.json();console.log("Loaded profile data:",a),r(a)}catch(t){console.error("Profile loading error:",t),f("Failed to load profile: "+t.message),(t.message.includes("401")||t.message.includes("Unauthorized"))&&(l(),o("/login"))}finally{w(!1)}};n.useEffect(()=>{if(!c){if(!i){w(!1),o("/login");return}T()}},[i,c,l,o]);const g=t=>{const{name:a,value:d}=t.target;r({...s,[a]:d}),a==="username"&&b("")},A=async t=>{t.preventDefault(),S(!0),f(""),p(""),b("");try{console.log("Submitting profile data:",s);const a=await y("/profile",{method:"PUT",body:JSON.stringify(s)});if(!a.ok){if(a.status===401){l(),o("/login");return}const v=await a.json();if(a.status===400&&v.error.includes("Username")){b(v.error);return}throw new Error(`HTTP ${a.status}: ${v.error||"Failed to update profile"}`)}const d=await a.json();console.log("Updated profile response:",d),r(d),j({username:d.username,email:d.email}),p("✅ Profile updated successfully!"),setTimeout(()=>p(""),3e3)}catch(a){console.error("Profile update error:",a),f("Failed to update profile: "+a.message),(a.message.includes("401")||a.message.includes("Unauthorized"))&&(l(),o("/login"))}finally{S(!1)}},L=async()=>{if(confirm("Are you sure you want to delete your account? This action cannot be undone."))try{const t=await y("/profile",{method:"DELETE"});if(!t.ok){if(t.status===401){l(),o("/login");return}throw new Error(`HTTP ${t.status}: Failed to delete account`)}alert("Account deleted successfully"),l(),m(),x(),o("/")}catch(t){console.error("Account deletion error:",t),f("Failed to delete account: "+t.message),(t.message.includes("401")||t.message.includes("Unauthorized"))&&(l(),o("/login"))}},I=()=>{l(),m(),x(),o("/")};return c||u?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500 mx-auto mb-4"}),e.jsx("p",{className:"text-[#171717]",children:"Loading profile..."})]})}):i?e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-pink-500 to-purple-600 px-6 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"My Profile"}),e.jsx("p",{className:"text-white/90",children:"Manage your account settings and preferences"})]}),P&&e.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 mx-6 mt-4 rounded",children:P}),E&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 mx-6 mt-4 rounded",children:E}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex space-x-8 px-6",children:[e.jsx("button",{onClick:()=>C("profile"),className:`py-4 px-1 border-b-2 font-medium text-sm ${h==="profile"?"border-pink-500 text-pink-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Profile Information"}),e.jsx("button",{onClick:()=>C("orders"),className:`py-4 px-1 border-b-2 font-medium text-sm ${h==="orders"?"border-pink-500 text-pink-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Order History"})]})}),e.jsxs("div",{className:"p-6",children:[h==="profile"&&e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Username *"}),e.jsx("input",{type:"text",name:"username",value:s.username||"",onChange:g,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500 ${N?"border-red-500":"border-gray-300"}`,placeholder:"Enter your username",required:!0,style:{backgroundColor:"#ffffff",color:"#111827"}}),N&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:N}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Choose a unique username that others can use to find you"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsx("input",{type:"email",value:s.email||"",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 text-gray-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Email cannot be changed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name"}),e.jsx("input",{type:"text",name:"first_name",value:s.first_name||"",onChange:g,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500",style:{backgroundColor:"#ffffff",color:"#111827"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name"}),e.jsx("input",{type:"text",name:"last_name",value:s.last_name||"",onChange:g,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500",style:{backgroundColor:"#ffffff",color:"#111827"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone"}),e.jsx("input",{type:"tel",name:"phone",value:s.phone||"",onChange:g,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500",style:{backgroundColor:"#ffffff",color:"#111827"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address"}),e.jsx("textarea",{name:"address",value:s.address||"",onChange:g,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500",style:{backgroundColor:"#ffffff",color:"#111827"}})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-6",children:[e.jsx("button",{type:"submit",disabled:k,className:"flex-1 bg-pink-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-pink-600 disabled:opacity-50 disabled:cursor-not-allowed",children:k?"Saving...":"Save Changes"}),e.jsx("button",{type:"button",onClick:I,className:"flex-1 bg-gray-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-gray-600",children:"Logout"})]}),e.jsxs("div",{className:"pt-6 border-t border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-600 mb-4",children:"Danger Zone"}),e.jsx("button",{type:"button",onClick:L,className:"bg-red-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-red-600",children:"Delete Account"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"This action cannot be undone. All your data will be permanently deleted."})]})]}),h==="orders"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Order History"}),e.jsx(z,{})]})]})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Please log in"}),e.jsx("button",{onClick:()=>o("/login"),className:"bg-pink-500 text-white px-6 py-2 rounded-lg hover:bg-pink-600",children:"Go to Login"})]})})}export{K as default};
